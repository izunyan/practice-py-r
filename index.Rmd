---
title: "Rã¨Pythonã¯ä»²è‰¯ã—"
author: "ã‚„ã‚ã‚‰ã‹ã‚¯ã‚¸ãƒ©"
date: "`r format(Sys.time(), '%Y/%m/%d')`"
output:
  html_document: 
    toc: TRUE
    toc_float: true
    toc_depth: 4
    number_sections: true
    # theme: readable
    # highlight: pygments
    css: custom.css
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)


# tibbleã®è¡¨ç¤ºè¡Œæ•°æŒ‡å®š
tibble_opt <- list(
  "tibble.print_min" = 5 #, # è¡¨ç¤ºã™ã‚‹è¡Œã®æ•°
  # "tibble.width" = 65     # æ¨ªã®è¡¨ç¤ºå¹…
)

options(tibble_opt)

```

# æœ¬è³‡æ–™ã®èª¬æ˜

- ç¬¬100å› Tokyo.Rã§ã®ç™ºè¡¨ã«å‘ã‘ã¦è‡ªåˆ†ã®ãŸã‚ã«ä½œã£ãŸRã¨Pythoné€£æºå‘¨ã‚Šã®ãƒ¡ãƒ¢
- ç™ºè¡¨è³‡æ–™ã¯[ã“ã¡ã‚‰](https://github.com/izunyan/practice_py_r/tree/main/pdf)
- ã“ã®htmlã¯å¸¸ã«æ›´æ–°ã•ã‚Œç¶šã‘ã¾ã™

# ğŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‹ã‚‰ç’°å¢ƒè¨­å®šå‘¨ã‚Š
## Windowsã§ã®Pythonã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
-   å…¬å¼ã‚µã‚¤ãƒˆã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    - <https://www.python.org/downloads/>

-   `Add Python 3.x to PATH`ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
    -   å‚ç…§ï¼š<https://www.python.jp/install/windows/install.html>

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç®¡ç†ï¼ˆpipé–¢é€£ï¼‰

<!-- 
Using the RStudio Terminal in the RStudio IDE
https://support.rstudio.com/hc/en-us/articles/115010737148-Using-the-RStudio-Terminal-in-the-RStudio-IDE

Installing and Configuring Python with RStudio
https://support.rstudio.com/hc/en-us/articles/360023654474-Installing-and-Configuring-Python-with-RStudio


 -->

<!-- python Japan -->
<!-- https://www.python.jp/install/windows/pip.html -->

<!-- å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ -->
<!-- https://pip.pypa.io/en/stable/ -->


-   ä»¥ä¸‹ï¼ŒRStudioã®Terminalã‹ã‚‰å®Ÿè¡Œ
    -  ãŸã ã—ä»®æƒ³ç’°å¢ƒã‚ã‚‹ã¨ã§ããªã„ã½ã„ï¼Ÿ
    - Windowsã§ã¯ï¼Œã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‹ã‚‰ã‚‚å®Ÿè¡Œã§ãã‚‹
    - `Windowsã‚­ãƒ¼ï¼‹R`ï¼Œã¾ãŸã¯ï¼Œã‚¿ã‚¹ã‚¯ãƒãƒ¼ã«ã‚ã‚‹ã€Œã“ã“ã«å…¥åŠ›ã—ã¦æ¤œç´¢ã€ã«`cmd`ã¨å…¥ã‚Œã¦æ¤œç´¢
    
-   pipãŒé©ç”¨ã•ã‚Œã‚‹Pythonã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
    -   `python -V`
-   çœç•¥ã—ã¦ã‚‚å®Ÿè¡Œå¯èƒ½ã ãŒï¼Œ`python -m`ã‚’æœ€åˆã«ã¤ã‘ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã‚‹
-   ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ç¢ºèª
    -   `python -m pip list`
-   ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    -   `python -m pip install ã“ã“ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å`
-   ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€è¦§
    -   `python -m pip list -o`
-   ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
    -   `python -m pip install -U ã“ã“ã«ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å`
-   pipè‡ªä½“ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ
    -   `python -m pip install --upgrade pip`


<!-- * ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« -->

<!--   + pip install ï¼ˆã©ã“ã‹ã‚‰ã‹å¿˜ã‚ŒãŸâ€¦è¦ç¢ºèªï¼‰ -->

## Terminal OR ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®æ“ä½œ

-   ç¾åœ¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¡¨ç¤º
    -   `pwd`
-   ãƒ«ãƒ¼ãƒˆã«ç§»å‹•
    -   `cd \`
-   ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã‚«ãƒ¬ãƒ³ãƒˆã«
    -   `cd ã“ã“ã«ãƒ‘ã‚¹`
-   ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
    -   `mkdir ãƒ•ã‚©ãƒ«ãƒ€å`
-   æ§‹é€ å›³å¼åŒ–
    -   `tree`

## ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰jupyter labã‚’ä½¿ã†
- å…¥ã£ã¦ãªã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    - `python -m install jupyterlab`
- terminalã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‹ã‚Œã‚‹
    - `jupyter lab`
    

## ä»®æƒ³ç’°å¢ƒ:venv

-   ä»¥ä¸‹ï¼Œã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¾ãŸã¯RStudioã®Terminalã‹ã‚‰å®Ÿè¡Œ
-   ä½œæˆ
    -   `python -m venv ãƒ‘ã‚¹å\myenv` (åå‰ã¯ä»»æ„;ã“ã®ä¸¸ã‚«ãƒƒã‚³éƒ¨åˆ†ã”ã¨ä¸è¦)
    -   è©²å½“ãƒ•ã‚©ãƒ«ãƒ€ãŒã™ã§ã«ã‚«ãƒ¬ãƒ³ãƒˆã«ãªã£ã¦ã„ã‚Œã°myenvã ã‘ã§OK
-   ä»®æƒ³ç’°å¢ƒã«å…¥ã‚‹
    -   `myenv\Scripts\activate`
-   ä»®æƒ³ç’°å¢ƒã‹ã‚‰å‡ºã‚‹
    -   `deactivate`


## RStudioã§åˆã‚ã¦Pythonã‚’å®Ÿè¡Œã™ã‚‹éš›ã®æ³¨æ„

-  ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§minicondaã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ãã‹ã‚ŒãŸã‚‰No(n)ã¨å›ç­”

## å®Ÿè¡Œç’°å¢ƒ

### R
```{r}
sinfo <- 
sessioninfo::session_info()

sinfo$platform

```

<!-- xfun::session_info() -->


### RStudio version
```{r}
rsinfo <- 
rstudioapi::versionInfo()

rsinfo$version
```

### Python
```{r include=FALSE}
reticulate::repl_python()
```

```{r}
reticulate::py_version()

```


# åŸºæœ¬ç”¨èª

## R
### ãƒ™ã‚¯ãƒˆãƒ«
```{r}
r_vec <- c(1, 2, 3)
r_vec
```

### åå‰ä»˜ããƒ™ã‚¯ãƒˆãƒ«
```{r}
r_nvec <- c(a = 1, b = 2, c = 3)
r_nvec
```


### ãƒªã‚¹ãƒˆ
```{r}
r_l <- list(1, 2, 3)
r_l
```

### åå‰ä»˜ããƒªã‚¹ãƒˆ
```{r}
r_nl <- list(a = 1, b = 2, c = 3)
r_nl
```


## python

-   <https://docs.python.org/ja/3/tutorial/datastructures.html#data-structures>

### ãƒªã‚¹ãƒˆ


```{python class.source="bg-success"}
py_l = [1,2,3]
py_l
```

```{python class.source="bg-success"}
py_l2 = [1,'a',3]
py_l2
```


### è¾æ›¸å‹ï¼šdictionary

```{python class.source="bg-success"}
py_d = {'x':1, 'y':2}
py_d
```

### ã‚¿ãƒ—ãƒ«ï¼štuple

```{python class.source="bg-success"}
py_t = (3,4,5)
py_t
```


### np.array é…åˆ—

```{python class.source="bg-success"}
import numpy as np
py_ndarray = np.array([1,2,3])
py_ndarray

py_ndarray2 = np.array([[1,2,3],[4,5,6]])
py_ndarray2
```

### ãƒ¡ã‚½ãƒƒãƒ‰

-   ãƒ‡ãƒ¼ã‚¿ã«çµã³ã¤ã„ãŸé–¢æ•°

<https://www.python.jp/train/string/method.html>

```{python class.source="bg-success"}

```


# ğŸ“™Rã¨pythonã§ç›¸äº’ã®èª­ã¿è¾¼ã¿

## Rã¨Pythonã§ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚„ã‚Šå–ã‚Š

-   ç·‘ãƒãƒ£ãƒ³ã‚¯ãŒpython

### Rã§ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ èª­ã¿è¾¼ã¿
```{r }
library(reticulate)

df_r <- palmerpenguins::penguins

```

### Pythonã§Rã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ èª­ã¿è¾¼ã¿ã—ã¦åˆ—é¸æŠ

* æ³¨æ„ï¼ï¼šæ•´æ•°å‹ã®NAãŒï¼ŒPythonã§ã¯-2147483648ã¨èª­ã¿è¾¼ã¾ã‚Œã‚‹
* å¯¾å‡¦æ³•ã¯æ¤œè¨ä¸­

```{python class.source="bg-success"}
r.df_r.head()

df_py = r.df_r[['species',	'bill_length_mm']]
```


### Rã‹ã‚‰Pythonã§åŠ å·¥ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ èª­ã¿è¾¼ã¿
```{r }
head(py$df_py)

rm(df_r) # dfå‰Šé™¤
```

## ã“ã“ã¾ã§ä½œã£ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ•´ç†

### pythonã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå‰Šé™¤

```{python class.source="bg-success"}
del df_py
```



## Rã§Pythonã®å¤‰æ•°ã‚’èª­ã‚€

-   reticulate cheatsheetã‚ˆã‚Š

| R                     | Python            |
|-----------------------|-------------------|
| single-element vector | scalar            |
| multi-element vector  | list              |
| list of mutiple types | tuple             |
| named list            | dict              |
| matrix/array          | numpy ndarray     |
| dataframe             | pandas DataFrame  |
| function              | python function   |
| NULL, TRUE, FALSE     | None, True, False |

-   ãƒªã‚¹ãƒˆï¼ˆPythonï¼‰ã€€â†’ã€€ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆRï¼‰

```{r}
py$py_l
```

-   å‹ãŒæ··åœ¨ã—ãŸãƒªã‚¹ãƒˆï¼ˆPythonï¼‰ã€€â†’ã€€ãƒªã‚¹ãƒˆï¼ˆRï¼‰

```{r}
py$py_l2
```


-   è¾æ›¸å‹ï¼ˆPythonï¼‰ã€€â†’ã€€åå‰ä»˜ããƒªã‚¹ãƒˆï¼ˆRï¼‰

```{r}
py$py_d
```

-   ã‚¿ãƒ—ãƒ«ï¼ˆPythonï¼‰ã€€â†’ã€€ãƒªã‚¹ãƒˆï¼ˆRï¼‰

```{r}
py$py_t
```


-   numpy.ndarray

```{r}
py$py_ndarray
py$py_ndarray2

```


## Pythonã§Rã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã‚€

- ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆRï¼‰ â†’ ãƒªã‚¹ãƒˆï¼ˆPythonï¼‰

```{python class.source="bg-success"}
r.r_vec
```

- åå‰ä»˜ããƒ™ã‚¯ãƒˆãƒ«ï¼ˆRï¼‰ â†’ ãƒªã‚¹ãƒˆï¼ˆPythonï¼‰

```{python class.source="bg-success"}
r.r_nvec
```

- ãƒªã‚¹ãƒˆï¼ˆRï¼‰ â†’ ãƒªã‚¹ãƒˆï¼ˆPythonï¼‰

```{python class.source="bg-success"}
r.r_l
```

- åå‰ä»˜ããƒªã‚¹ãƒˆï¼ˆRï¼‰ â†’ è¾æ›¸å‹ï¼ˆPythonï¼‰

```{python class.source="bg-success"}
r.r_nl
```


# ğŸŒŒğŸ¼ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ æ“ä½œã®åŸºæœ¬å‹•è©

* Rã®tidyverseã®ã‚¤ãƒ¡ãƒ¼ã‚¸  :ğŸŒŒ
* Pythonã®pandasã®ã‚¤ãƒ¡ãƒ¼ã‚¸:ğŸ¼

## Pythonã®è³‡æ–™

* cheatsheet
  - https://pandas.pydata.org/docs/whatsnew/v0.19.2.html

* cookbook
  - https://pandas.pydata.org/docs/user_guide/cookbook.html

## â˜…ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ èª­ã¿è¾¼ã¿
### R
```{r}
pen_r <-   palmerpenguins::penguins

```

### Pythonã§ã‚‚ãƒšãƒ³ã‚®ãƒ³

-   ãƒšãƒ³ã‚®ãƒ³ãƒ‡ãƒ¼ã‚¿ for python
    -   <https://pypi.org/project/palmerpenguins/>

```{python class.source="bg-success"}
from palmerpenguins import load_penguins
pen_p = load_penguins()
 
pen_p
```

## åˆ—ã‚’é¸ã¶

### åˆ—åã‹ã‚‰

#### R

* å˜ä¸€

```{r}
library(tidyverse)

# åˆ—åç¢ºèª
names(pen_r)

pen_r |> 
  select(species)

```

* è¤‡æ•°åˆ—

```{r}
pen_r |> 
  select(species, bill_length_mm)

pen_r |> 
  select(species:bill_length_mm)
```


* åˆ—ã®å€¤ï¼ˆãƒ™ã‚¯ãƒˆãƒ«ï¼‰ã‚’å–ã‚Šå‡ºã—

```{r}
pen_r |> pull(species)
```


#### Python

* å˜ä¸€

```{python class.source="bg-success"}
# åˆ—åç¢ºèª
pen_p.columns

pen_p[['species']]


```

* è¤‡æ•°åˆ—

```{python class.source="bg-success"}
pen_p[['species', 'bill_length_mm']]


pen_p.loc[:, 'species':'bill_length_mm']
```


* åˆ—ã®å€¤ã‚’å–ã‚Šå‡ºã—ï¼Ÿ

```{python class.source="bg-success"}
pen_p['species']
pen_p.species
```


### åˆ—åã‚’æ­£è¦è¡¨ç¾ã§é¸ã¶

#### R

```{r}
pen_r |> 
  select(matches("^bill")) # starts_with("bill")


pen_r |> 
  select(matches("mm$")) # ends_with("mm")



```

#### Python

<!-- https://stackoverflow.com/questions/30808430/how-to-select-columns-from-dataframe-by-regex -->

```{python class.source="bg-success"}
pen_p.filter(regex = '^bill')

pen_p.filter(regex = 'mm$')

```

```{python class.source="bg-success"}
pen_p.loc[:, pen_p.columns.str.match('^bill')]

```

### åˆ—ã‚’å‰Šé™¤ã™ã‚‹ 
#### R

```{r}
pen_r |> select(!c(species, island))
```

#### Python

```{python class.source="bg-success"}
pen_p.drop(columns = ['species', 'island'])
```


### 
#### R

```{r}

```

#### Python

```{python class.source="bg-success"}

```

## åˆ—åã‚’å¤‰æ›´ã™ã‚‹

### R

-   new = old

```{r}
pen_r |> 
  rename(species2 = species,
         island2  = island)
```

### Python

-   'old':'new'

```{python class.source="bg-success"}
pen_p.rename(columns = {'species':'species2',
                        'island':'island2'})

```


## åˆ—ã®å€¤ã§ä¸¦ã³å¤‰ãˆã‚‹
### R

```{r}
# æ˜‡é †
pen_r |> arrange(bill_length_mm)

# é™é †
pen_r |> arrange(desc(bill_length_mm))


```

### Python

```{python class.source="bg-success"}
# æ˜‡é †
pen_p.sort_values('bill_length_mm')

# é™é †
pen_p.sort_values('bill_length_mm', ascending = False)
```

## è¡Œã‚’é¸ã¶
### åŸºæœ¬
#### R

```{r}
pen_r |> 
  filter(bill_length_mm > 55)

pen_r |> 
  filter(bill_length_mm > 55 & bill_depth_mm == 17)


pen_r |> 
  filter(species == "Gentoo")

pen_r |> 
  filter(str_detect(species, "Gen"))


```

#### Python

<!-- https://stackoverflow.com/questions/17071871/how-do-i-select-rows-from-a-dataframe-based-on-column-values -->

<!-- https://towardsdatascience.com/how-to-select-rows-from-pandas-dataframe-based-on-column-values-d3f5da421e93 -->



```{python class.source="bg-success"}
pen_p[pen_p['bill_length_mm'] > 55]
pen_p[pen_p.bill_length_mm > 55]

pen_p.query('bill_length_mm > 55 & bill_depth_mm == 17')

pen_p.query('species == "Gentoo"')

pen_p[pen_p['species'].str.contains('Gen')] # match
pen_p.loc[pen_p.species.str.contains('Gen')] # match

```

### æ¬ æã®ã‚ã‚‹è¡Œã‚’è½ã¨ã™
#### R

```{r}
pen_r |> 
  drop_na(sex, bill_length_mm)

# ç¢ºèª
pen_r |> 
  drop_na(sex, bill_length_mm) |> 
  count(sex)
```

#### Python

* https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.dropna.html

```{python class.source="bg-success"}
pen_p.dropna(subset = ['sex'])

# ç¢ºèª
pen_p.dropna(subset = ['sex']).value_counts(['sex'])
```


## æ–°ãŸãªåˆ—ã‚’ä½œã‚‹
### åŸºæœ¬
#### R

```{r}
pen_r |> 
  mutate(species2 = species,
         island2 = island) 

# åˆ—ã‚’é¸æŠã—ã¦ã‹ã‚‰ï¼ˆè¡¨ç¤ºã®ãŸã‚ï¼‰
pen_r |> 
  select(species) |> 
  mutate(species2 = species) 
```

#### Python

```{python class.source="bg-success"}
pen_p.assign(species2 = pen_p['species'],
              island2 = pen_p['island'])

# åˆ—ã‚’é¸æŠã—ã¦ã‹ã‚‰è¡¨ç¤ºã®ãŸã‚
pen_p[['species']].assign(species2 = pen_p['species'])  

```


### é€£ç¶šé‡ã®ã‚«ãƒ†ã‚´ãƒªåŒ–åˆ—ä½œæˆ
#### R

```{r}
hist(pen_r$bill_length_mm)

pen_r <- 
  pen_r |> 
  mutate(blmc = case_when(bill_length_mm < 40 ~ "first",
                          bill_length_mm >= 40 & bill_length_mm < 50 ~ "second",
                          bill_length_mm >= 50 ~ "third")) 

# ç¢ºèª
pen_r |> 
  count(blmc, bill_length_mm)

pen_r |> 
  count(blmc)


```

#### Python

<!-- https://stackoverflow.com/questions/54653356/case-when-function-from-r-to-python -->
<!-- https://stackoverflow.com/questions/66944310/using-case-when-with-mutate-equivalent-in-python -->

##### æ–¹æ³•1 np.select
```{python class.source="bg-success"}
## åˆ†å¸ƒç¢ºèª
# import matplotlib.pyplot as plt
# pen_p[['bill_length_mm']].plt.hist()

## æ¡ä»¶ã§å¤‰æ•°ä½œæˆ
import numpy as np

## np.selectã®ä¸­ã«å…¥ã‚Œã‚‹éƒ¨åˆ†ã‚’ä½œæˆ

conditions = [
  (pen_p["bill_length_mm"] < 40),
  (pen_p["bill_length_mm"] >= 40) & (pen_p["bill_length_mm"] < 50),
  (pen_p["bill_length_mm"] >= 50)
]

# ã¾ãŸã¯
# conditions = [
#   (pen_p["bill_length_mm"].lt(40)),
#   (pen_p["bill_length_mm"].ge(40) & pen_p["bill_length_mm"].lt(50)),
#   (pen_p["bill_length_mm"].ge(50))
# ]

choices = ["first", "second", "third"]

## np.selectã®å®Ÿè¡Œ
(
pen_p.assign(blmc = np.select(conditions, choices))
     .value_counts(['blmc'])
)

# pen_p["blmc"] = np.select(conditions, choices)


# ç¢ºèª
# pen_p.value_counts(['blmc', 'bill_length_mm'])
# 
# pen_p.value_counts(['blmc'])
```


<!-- https://stackoverflow.com/questions/57609780/pandas-using-assign-and-if-else-statement-in-method-chaining -->
<!-- https://stackoverflow.com/questions/49762705/if-else-conditional-assignment-in-pandas -->



##### æ–¹æ³•2 np.cut
###### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯åŒºåˆ†ç‚¹ã¾ã§ãŒç¯„å›²ã¨ãªã‚‹
```{python class.source="bg-success"}
import pandas as pd

(
pen_p.assign(blmc2 = lambda x: pd.cut(x['bill_length_mm'], 
                                              bins=[0, 40, 50, 100]))
     .value_counts(['blmc2'])

)
```

###### åŒºåˆ†ç‚¹æœªæº€ã¾ã§ã«ã™ã‚‹ãŸã‚ã®å¼•æ•°
```{python class.source="bg-success"}
(
pen_p.assign(blmc2 = lambda x: pd.cut(x['bill_length_mm'], 
                                              bins=[0, 40, 50, 100],
                                              right = False))
     .value_counts(['blmc2'])

)

```

###### ãƒ©ãƒ™ãƒ«åä»˜ä¸
```{python class.source="bg-success"}
(
pen_p.assign(blmc2 = lambda x: pd.cut(x['bill_length_mm'], 
                                              bins=[0, 40, 50, 100],
                                              right = False,
                                              labels=["first", "second", "third"]))
     .value_counts(['blmc2'])
)

```


##### æ–¹æ³•3 np.where

* ãŸã ã—ï¼Œthirdã®ã‚«ãƒ†ã‚´ãƒªã«NAãŒå«ã¾ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œå·¥å¤«ãŒå¿…è¦

<!-- https://stackoverflow.com/questions/39109045/numpy-where-with-multiple-conditions -->


```{python class.source="bg-success"}

(
pen_p.assign(blmc3 = np.where(pen_p.bill_length_mm < 40, 'first',
                   (np.where(pen_p.bill_length_mm < 50, 'second', 'third'))
                   )
                   )
     .value_counts(['blmc3'])               
)

```

* bill_length_mmãŒnanã ã£ãŸå ´åˆã«blmc3ã‚’nanã«å¤‰æ›

```{python class.source="bg-success"}
pen_p = (
pen_p.assign(blmc3 = np.where(pen_p.bill_length_mm < 40, 'first',
                   (np.where(pen_p.bill_length_mm < 50, 'second', 'third'))
                   )
                   )       
)

pen_p.loc[pen_p.bill_length_mm.isnull(), 'blmc3'] = np.nan

pen_p.value_counts(['blmc3'])
```


### æ¡ä»¶ã§æ–°ã—ã„åˆ—ä½œæˆ
#### R

```{r}
pen_r |> 
  mutate(species2 = if_else(species == "Adelie", 1,0)) |> 
  count(species, species2)
```

#### Python

<!-- æ¬ æå€¤ã®ã‚ã¤ã‹ã„ -->
<!-- https://stackoverflow.com/questions/66081445/from-r-to-python-ifelse-conditional-in-mutate-dataframe -->

```{python class.source="bg-success"}
(
pen_p.assign(species2 = np.where(pen_p['species'].isin(['Adelie']), 1, 0))
     .value_counts(['species', 'species2'])     
)
```

### 
#### R

```{r}
```

#### Python

```{python class.source="bg-success"}

```

## è¦ç´„å€¤ä½œæˆ

### å¤‰æ•°1ã¤ã®ã¿

#### R

```{r}
pen_r |> 
  summarise(blm_mean = mean(bill_length_mm, 
                            na.rm = TRUE),
            blm_sd   = sd(bill_length_mm, 
                            na.rm = TRUE),
            blm_n    = sum(!is.na(bill_length_mm)))
```

#### Python

-   æ¬ æå€¤ã¯è‡ªå‹•ã§å‰Šé™¤ã—ã¦è¨ˆç®—ã•ã‚Œã¦ã„ã‚‹

```{python class.source="bg-success"}
pen_p.bill_length_mm.mean()
pen_p.bill_length_mm.std()
pen_p.bill_length_mm.count()
```

-   [pandas.DataFrame.aggregate](https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.aggregate.html#)
-   çŸ­ç¸®ã—ã¦`agg`ã§å®Ÿè¡Œã§ãã‚‹

```{python class.source="bg-success"}
pen_p.bill_length_mm.agg(['mean', 'std', 'count'])
```

```{python class.source="bg-success"}
# çµæœã‚’ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã§è¿”ã™ã«ã¯

pen_p.agg({'bill_length_mm' : ['mean', 'std', 'count']})
```



### å¤‰æ•°è¤‡æ•°

#### R

```{r}
pen_r |> 
  summarise(across(c(bill_length_mm, bill_depth_mm),
                   list(mean = ~mean(., na.rm = TRUE),
                          sd =   ~sd(., na.rm = TRUE),
                           n =  ~sum(!is.na(.)))))

# åˆ—åæ ¼ç´ç‰ˆ
cols <- c("bill_length_mm", "bill_depth_mm")
pen_r |> 
  summarise(across(all_of(cols),
                   list(mean = ~mean(., na.rm = TRUE),
                          sd =   ~sd(., na.rm = TRUE),
                           n =  ~sum(!is.na(.)))))


```

#### Python

```{python class.source="bg-success"}
pen_p.agg({'bill_length_mm' : ['mean', 'std', 'count'],
            'bill_depth_mm' : ['mean', 'std', 'count']})

```

-   å…ˆã«åˆ—é¸æŠã™ã‚Œã°é–¢æ•°ç¹°ã‚Šè¿”ã•ãªãã¦ã‚‚ã‚ˆã„

```{python class.source="bg-success"}
pen_p[['bill_length_mm', 'bill_depth_mm']].agg(['mean', 'std', 'count'])

# åˆ—åæ ¼ç´ç‰ˆ
cols = ['bill_length_mm', 'bill_depth_mm']
pen_p[cols].agg(['mean', 'std', 'count'])

```

### ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«é›†è¨ˆ

#### R

```{r}
pen_r |> 
  group_by(species) |> 
  summarise(mean_blm = mean(bill_length_mm, 
                            na.rm = TRUE))
```

#### Python

```{python class.source="bg-success"}
pen_p.groupby('species').bill_length_mm.agg('mean')

```

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ å…¨ä½“

#### R

```{r}
pen_r |> 
  summarise(across(where(is.numeric),
    mean, na.rm = TRUE))
```

#### Python

```{python class.source="bg-success"}
pen_p.agg('mean')
```




### åº¦æ•°åˆ†å¸ƒ 
#### R

```{r}
pen_r |> count(species)

pen_r |> count(sex)
```

#### Python

```{python class.source="bg-success"}
pen_p.value_counts(['species'])

pen_p.value_counts(['sex'], dropna = False)
```

### è¤‡æ•°åˆ—ã®çµ„ã¿åˆã‚ã›ã®åº¦æ•° 
#### R

```{r}
pen_r |> count(species, sex)
```

#### Python

```{python class.source="bg-success"}
pen_p.value_counts(['species', 'sex'])

```



### ã‚¯ãƒ­ã‚¹è¡¨ 
#### R


```{r}
table(pen_r$species, pen_r$sex)
```


#### Python



```{python class.source="bg-success"}
pd.crosstab(pen_p['species'], pen_p['sex'])
pd.crosstab(pen_p.species, pen_p.sex)
```

## å‹•è©ã‚’ã¤ãªã’ã‚‹
### R

-   `|>`ã§ã¤ãªã’ã‚‹

```{r}
pen_r |> 
  select(species, bill_length_mm) |> 
  filter(species == "Gentoo")


```

### Python

-   [pandasãƒãƒ¼ãƒˆã‚·ãƒ¼ãƒˆ]<https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf
-   `.`(ãƒ‰ãƒƒãƒˆï¼Œãƒ”ãƒªã‚ªãƒ‰)ã§ã¤ãªã’ã¦ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’`( )`ã§å›²ã‚€

```{python class.source="bg-success"}

(
  pen_p[['species', 'bill_length_mm']]
      .query('species == "Gentoo"')
 )

```

# ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã®é€£çµã‚„æ§‹é€ å¤‰æ›

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ä½œæˆ

### R

```{r}
df_r_a <- 
 tribble(
    ~id, ~x1, ~x2,
    1,  10,  50,
    2,  20,  60,
    3,  30,  70
  )

df_r_b <- 
  tribble(
    ~id, ~x1, ~x3,
    1,  10,  80,
    2,  20,  90,
    4,  40, 100
  )

df_r_a
df_r_b
```

### Python

```{python class.source="bg-success"}
df_py_a = pd.DataFrame([[1,10,50], 
                        [2,20,60], 
                        [3,30,70]],
              columns = ['id','x1','x2'])

df_py_b = pd.DataFrame([[1,10,80], 
                        [2,20,90], 
                        [4,40,100]],
              columns = ['id','x1','x3'])


df_py_a
df_py_b

# ã¾ãŸã¯

pd.DataFrame({'id':[1,2,3],
              'x1':[10,20,30], 
              'x2':[50,60,70]})


```

## ã‚­ãƒ¼å¤‰æ•°ã‚’å…ƒã«æ¨ªã«é€£çµ

-   [dplyr::join](https://dplyr.tidyverse.org/reference/mutate-joins.html)
-   [pandas.merge](https://pandas.pydata.org/docs/reference/api/pandas.merge.html#)

### å·¦ã«é€£çµ

#### R

```{r}
df_r_a |> 
  left_join(df_r_b, by = "id")
```

#### Python

```{python class.source="bg-success"}
pd.merge(df_py_a, df_py_b, on = 'id', how = 'left')
```

### ã™ã¹ã¦é€£çµ

#### R

```{r}
df_r_a |> 
  full_join(df_r_b)
```

#### Python

```{python class.source="bg-success"}
pd.merge(df_py_a, df_py_b, how = 'outer')
```

### å…±é€šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã®é€£çµ

#### R

```{r}
df_r_a |> 
  inner_join(df_r_b)
```

#### Python

```{python class.source="bg-success"}
pd.merge(df_py_a, df_py_b, how = 'inner')
```

## ç¸¦ã«é€£çµ

### R

```{r}
# é€£çµç”¨ãƒ‡ãƒ¼ã‚¿ä½œæˆ
df_r_b2 <- 
  tribble(
    ~id, ~x1, ~x2, ~x3,
    4,  40, 80,  110,
    5,  50, 90,  120,
    6,  60, 100, 130
  )

df_r_b2

# ç¸¦ã«é€£çµ
df_r_a |> 
  bind_rows(df_r_b2)
```

#### é€£çµå…ƒãƒ‡ãƒ¼ã‚¿ã‚’ç¤ºã™idã‚’ä»˜ä¸

```{r}
df_r_a |> 
  bind_rows(df_r_b2, .id = "df_id")
```

-   ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ åã‚’ä»˜ã‘ãŸã‘ã‚Œã°ï¼Œä¸€æ—¦ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ãƒªã‚¹ãƒˆã«

```{r}

df_r_l <- list(df_r_a, df_r_b2) |> 
  set_names("df_r_a", "df_r_b2")

bind_rows(df_r_l, .id = "df_id")

```

### Python

```{python class.source="bg-success"}
# é€£çµç”¨ãƒ‡ãƒ¼ã‚¿ä½œæˆ
df_py_b2 = pd.DataFrame([[4,40,80,110], 
                         [5,50,90,120], 
                         [6,60,100,130]],
              columns = ['id','x1','x2','x3'])

df_py_b2

# ç¸¦ã«é€£çµ

pd.concat([df_py_a, df_py_b2])

```

#### é€£çµå…ƒãƒ‡ãƒ¼ã‚¿ã‚’ç¤ºã™idã‚’ä»˜ä¸

```{python class.source="bg-success"}
pd.concat([df_py_a, df_py_b2], 
          keys = ['df_py_a', 'df_py_b2'])
```

## ç¸¦æ¨ªæ§‹é€ ã®å¤‰æ›

### longå½¢å¼ã«

#### R

```{r}
df_r_a_long <- 
df_r_a |> 
pivot_longer(!id,
             names_to = "å¤‰æ•°",
             values_to = "å¾—ç‚¹")

df_r_a_long
```

#### Python

```{python class.source="bg-success"}
df_py_a_long = pd.melt(df_py_a, 
                           id_vars = ['id'],
                           var_name = 'å¤‰æ•°',
                           value_name = 'å¾—ç‚¹')
          
df_py_a_long          
```

### wideå½¢å¼ã«

#### R

```{r}
df_r_a_long |> 
  pivot_wider(names_from = å¤‰æ•°,
              values_from = å¾—ç‚¹)
```

#### Python

```{python class.source="bg-success"}
df_py_a_long.pivot(index = ['id'],
                   columns = ['å¤‰æ•°'],
                   values  = ['å¾—ç‚¹'])
```

### â€»ãƒ†ãƒ³ãƒ—ãƒ¬
#### R

```{r}

```

#### Python

```{python class.source="bg-success"}

```

# ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã
## ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿
### Excelãƒ•ã‚¡ã‚¤ãƒ«
#### R

```{r}
readxl::read_xlsx("data/ãƒšãƒ³ã‚®ãƒ³.xlsx")
```

#### Python

```{python class.source="bg-success"}
pd.read_excel('data/ãƒšãƒ³ã‚®ãƒ³.xlsx')
```

### csvãƒ•ã‚¡ã‚¤ãƒ«
#### utf-8
##### R

```{r}
penr_csv <- 
read_csv("data/ãƒšãƒ³ã‚®ãƒ³ï¼ˆã²ã©ã„åˆ—åï¼‰ver_utf8.csv")

penr_csv
```

##### Python

```{python class.source="bg-success"}
penp_csv = pd.read_csv('data/ãƒšãƒ³ã‚®ãƒ³ï¼ˆã²ã©ã„åˆ—åï¼‰ver_utf8.csv')

penp_csv
```

#### shift-jis(cp932)
##### R

```{r}
read_csv("data/ãƒšãƒ³ã‚®ãƒ³ï¼ˆã²ã©ã„åˆ—åï¼‰ver_cp932.csv",
         locale = locale(encoding = "cp932"))
```

##### Python

```{python class.source="bg-success"}
pd.read_csv('data/ãƒšãƒ³ã‚®ãƒ³ï¼ˆã²ã©ã„åˆ—åï¼‰ver_cp932.csv',
             encoding = 'cp932')
```

## ãƒ•ã‚¡ã‚¤ãƒ«ã®æ›¸ãå‡ºã—
### Excelãƒ•ã‚¡ã‚¤ãƒ«

#### R

* `library(writexl)`ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã‚Œã°ï¼Œ`writexl::`ã¯ä¸è¦

```{r eval = FALSE}
pen_r |>
  head(3) |> 
  writexl::write_xlsx("out/pen_r_head.xlsx")

```

#### Python

```{python  eval = FALSE, class.source="bg-success"}
pen_p.head(3).to_excel("out/pen_p_head.xlsx", index = False)

```


### csvãƒ•ã‚¡ã‚¤ãƒ«

#### R
```{r eval = FALSE}
pen_r |>
  head(3) |> 
  write_csv("out/pen_r_head.csv")
```

#### Python

```{python  eval = FALSE, class.source="bg-success"}
pen_p.head(3).to_csv("out/pen_p_head.csv", index = False)

```



# é–¢æ•°å®šç¾©

* https://rstudio.github.io/reticulate/articles/python_primer.html#defining-functions-with-def

## åŸºæœ¬
### R

```{r}
fn_r <- \(x){
  x + 1
} 

fn_r(1)
```

### Python

```{python class.source="bg-success"}
def fn_p(x):
  return x + 1
  
fn_p(1)  
```

## ç„¡åé–¢æ•°
### R

```{r}
(function(x) x + 1)(1)
(\(x) x + 1)(1)
```

### Python

* https://www1.gifu-u.ac.jp/~fujilab/lambda_html/index.html

```{python class.source="bg-success"}

(lambda x: x + 1)(1)



```



# â€»ãƒ†ãƒ³ãƒ—ãƒ¬
## 
### R

```{r}
```

### Python

```{python class.source="bg-success"}

```

# å‚è€ƒæƒ…å ±

<!-- https://book.pythontips.com/en/latest/index.html# -->
<!-- https://cs.stanford.edu/people/nick/py/ -->
<!-- https://python-course.eu/advanced-python/ -->
<!-- https://rinatz.github.io/python-book/ -->